<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>site builder</title>

<style>
body {
    font-family: system-ui, sans-serif;
    max-width: 720px;
    margin: 2rem auto;
}

#preview {
    border-top: 1px solid #ddd;
    margin-top: 2rem;
    padding-top: 2rem;
}
</style>
</head>
<body>

<input type="file" id="file" accept=".txt,.md">
<button id="export">export html</button>

<div id="preview"></div>

<script>
function mdToHtml(md) {
    return md
        .replace(/^### (.*)$/gim, "<h3>$1</h3>")
        .replace(/^## (.*)$/gim, "<h2>$1</h2>")
        .replace(/^# (.*)$/gim, "<h1>$1</h1>")
        .replace(/\*\*(.*?)\*\*/gim, "<strong>$1</strong>")
        .replace(/\*(.*?)\*/gim, "<em>$1</em>")
        .replace(/\n/g, "<br>");
}

function getDateTitle() {
    const d = new Date();
    const pad = n => String(n).padStart(2, "0");
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}-${pad(d.getMinutes())}`;
}

const TEMPLATE = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>__TITLE__</title>
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <nav>
        <span class="disp">raster</span>
        <a class="nav" href="/about">about</a>
        <a class="nav" href="/work">work</a>
        <a class="nav" href="/blog">blog</a>
        <a class="nav" href="/contact">contact</a>
        <a class="nav" href="/now">now</a>
    </nav>

__CONTENT__

<script data-collect-dnt="true" async src="https://scripts.simpleanalyticscdn.com/latest.js"><\/script>
<noscript>
<img src="https://queue.simpleanalyticscdn.com/noscript.gif?collect-dnt=true"
     alt="" referrerpolicy="no-referrer-when-downgrade"/>
</noscript>
</body>
</html>`;

let injectedHTML = "";

document.getElementById("file").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        injectedHTML = file.name.endsWith(".md")
            ? mdToHtml(reader.result)
            : reader.result;

        document.getElementById("preview").innerHTML = injectedHTML;
    };
    reader.readAsText(file);
});

document.getElementById("export").addEventListener("click", () => {
    const title = getDateTitle();

    const finalHTML = TEMPLATE
        .replace("__TITLE__", title)
        .replace("__CONTENT__", injectedHTML);

    const blob = new Blob([finalHTML], { type: "text/html" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "index.html";
    a.click();
});
</script>

</body>
</html>
